#!/usr/bin/env bash

input_urls=()

# Parse --file option
while [[ "$1" ]]; do
    if [[ "$1" == "--file" ]]; then
        shift
        [[ -f "$1" ]] && mapfile -t input_urls < "$1" || { echo "File not found: $1"; exit 1; }
    else
        input_urls+=("$1")
    fi
    shift
done

for url in "${input_urls[@]}"; do
    channel_id="$(yt-dlp --print channel_url --playlist-items 1 "$url" 2>/dev/null | sed 's|https://www\.youtube\.com/channel/||')"
    if [[ -z "$channel_id" ]]; then
        echo "Could not get channel_id for $url"
        continue
    fi
    output="https://www.youtube.com/feeds/videos.xml?channel_id=${channel_id} \"youtube\""
    echo "$output" >> "${XDG_CONFIG_HOME:-$HOME/.config}/newsboat/urls"
done

